<!DOCTYPE html>
<html>
<head>
    <title>Configuração do ModSecurity com Nginx</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            max-width: 800px;
        }
        h1, h2 {
            color: #333;
        }
        pre {
            background-color: #f4f4f4;
            padding: 10px;
            border: 1px solid #ccc;
            font-size: 16px;
            line-height: 1.4;
            overflow: auto;
            position: relative;
        }
        code {
            display: block;
        }
        .copy-button {
            position: absolute;
            top: 5px;
            right: 5px;
            padding: 5px 10px;
            background-color: #333;
            color: #fff;
            border: none;
            cursor: pointer;
        }
    </style>
</head>
<body>
  <h1>Configuração do ModSecurity com Nginx</h1>
<p>Este tutorial descreve os passos detalhados para configurar o ModSecurity com o Nginx em um sistema Linux. Siga as instruções cuidadosamente.</p>

<h2>Passo 1: Atualizar o Sistema e Instalar Dependências</h2>
<p>Atualize a lista de pacotes do sistema e instale as dependências necessárias:</p>
<pre><code id="comando1">apt update</code>
<button class="copy-button" onclick="copiarComando('comando1')">Copiar Comando</button>
</pre>
<pre><code id="comando2">apt install make gcc build-essential autoconf automake libtool libfuzzy-dev ssdeep gettext pkg-config libcurl4-openssl-dev liblua5.3-dev libpcre3 libpcre3-dev libxml2 libxml2-dev libyajl-dev doxygen libcurl4 libgeoip-dev libssl-dev zlib1g-dev libxslt-dev liblmdb-dev libpcre++-dev libgd-dev</code>
<button class="copy-button" onclick="copiarComando('comando2')">Copiar Comando</button>
</pre>

<h2>Passo 2: Instalar e Configurar o Nginx</h2>
<p>Instale o Nginx e prepare a estrutura de diretórios:</p>
<pre><code id="comando3">apt install nginx-core nginx-common nginx nginx-full</code>
<button class="copy-button" onclick="copiarComando('comando3')">Copiar Comando</button>
</pre>

<h2>Passo 3: Criar uma pasta para o Nginx</h2>
<pre><code id="comando4">mkdir -p /usr/local/src/nginx</code>
<button class="copy-button" onclick="copiarComando('comando4')">Copiar Comando</button>
</pre>

<h2>Passo 4: Alterar as permissões do usuário</h2>
<pre><code id="comando5">chown $USER:$USER -R /usr/local/src/</code>
<button class="copy-button" onclick="copiarComando('comando5')">Copiar Comando</button>
</pre>

<h2>Passo 5: Compilar e Instalar o ModSecurity</h2>
<pre><code id="comando6">cd /usr/local/src/ModSecurity/</code>
<button class="copy-button" onclick "copiarComando('comando6')">Copiar Comando</button>
</pre>
    
<h2>Passo 6: Obter o código-fonte do Nginx</h2>
<pre><code id="comando3">apt source nginx</code>
<button class="copy-button" onclick="copiarComando('comando3')">Copiar Comando</button>
</pre>
    
<h2>Passo 7: Verificar a versão do Nginx</h2>
<pre><code id="comando4">nginx -v</code>
<button class="copy-button" onclick "copiarComando('comando4')">Copiar Comando</button>
</pre>
    
<h2>Passo 8: Instalar o ModSecurity 3</h2>
<pre><code id="comando5">apt install libmodsecurity3</code>
<button class="copy-button" onclick="copiarComando('comando5')">Copiar Comando</button>
</pre>
   
<h2>Passo 9: Clonar o repositório do ModSecurity</h2>
<pre><code id="comando7">git clone --depth 1 -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity /usr/local/src/ModSecurity/</code>
<button class="copy-button" onclick="copiarComando('comando6')">Copiar Comando</button>
</pre>
<h2>Passo 9.1: Navegue até a pasta</h2>
<pre><code id="comando8">cd /usr/local/src/ModSecurity/</code>
<button class="copy-button" onclick="copiarComando('comando6')">Copiar Comando</button>
</pre>
    
<pre><code id="comando9">git submodule init</code>
<button class="copy-button" onclick="copiarComando('comando7')">Copiar Comando</button>
</pre>
<pre><code id="comando10">git submodule update</code>
<button class="copy-button" onclick="copiarComando('comando8')">Copiar Comando</button>
</pre>
<pre><code id="comando11">./build.sh</code>
<button class="copy-button" onclick="copiarComando('comando9')">Copiar Comando</button>
</pre>
<pre><code id="comando12">./configure</code>
<button class="copy-button" onclick="copiarComando('comando10')">Copiar Comando</button>
</pre>
<pre><code id="comando13">make -j4</code>
<button class="copy-button" onclick="copiarComando('comando11')">Copiar Comando</button>
</pre>
<pre><code id="comando14">make install</code>
<button class="copy-button" onclick="copiarComando('comando12')">Copiar Comando</button>
</pre>

<h2>Passo 10: Instalar o Módulo ModSecurity para o Nginx</h2>
<pre><code id="comando15">git clone --depth 1 https://github.com/SpiderLabs/ModSecurity-nginx.git /usr/local/src/ModSecurity-nginx/</code>
<button class="copy-button" onclick="copiarComando('comando13')">Copiar Comando</button>
</pre>
<pre><code id="comando16">cd /usr/local/src/nginx/nginx-1.18.0 && 
apt build-dep nginx
apt install uuid-dev</code>
<button class="copy-button" onclick="copiarComando('comando14')">Copiar Comando</button>
</pre>
<pre><code id="comando17">./configure --with-compat --add-dynamic-module=/usr/local/src/ModSecurity-nginx</code>
<button class="copy-button" onclick="copiarComando('comando15')">Copiar Comando</button>
</pre>
<pre><code id="comando18">make modules</code>
<button class="copy-button" onclick="copiarComando('comando16')">Copiar Comando</button>
</pre>
<pre><code id="comando19">cp objs/ngx_http_modsecurity_module.so /usr/share/nginx/modules/</code>
<button class="copy-button" onclick="copiarComando('comando17')">Copiar Comando</button>
</pre>

<h2>Passo 11: Configurar o ModSecurity com o Nginx</h2>
<pre><code id="comando20">nano /etc/nginx/nginx.conf</code>
<button class="copy-button" onclick="copiarComando('comando18')">Copiar Comando</button>
</pre>

<h2>Passo 12: Alterar as configurações do arquivo adicionando</h2>
<pre><code id="comando21">load_module modules/ngx_http_modsecurity_module.so;</code>
<button class="copy-button" onclick="copiarComando('comando19')">Copiar Comando</button>
</pre>
<pre><code id="comando22">modsecurity on;</code>
<button class="copy-button" onclick="copiarComando('comando20')">Copiar Comando</button>
</pre>
<pre><code id="comando23">modsecurity_rules_file /etc/nginx/modsec/main.conf;</code>
<button class="copy-button" onclick="copiarComando('comando21')">Copiar Comando</button>
</pre>

<h2>Passo 13: Criar o diretório de configuração ModSecurity</h2>
<pre><code id="comando24">mkdir /etc/nginx/modsec/</code>
<button class="copy-button" onclick="copiarComando('comando22')">Copiar Comando</button>
</pre>

<h2>Passo 14: Copiar o arquivo de configuração recomendado</h2>
<pre><code id="comando25">cp /usr/local/src/ModSecurity/modsecurity.conf-recommended /etc/nginx/modsec/modsecurity.conf</code>
<button class="copy-button" onclick="copiarComando('comando23')">Copiar Comando</button>
</pre>

<h2>Passo 14: Editar o arquivo de configuração ModSecurity</h2>
<pre><code id="comando26">nano /etc/nginx/modsec/modsecurity.conf</code>
<button class="copy-button" onclick="copiarComando('comando24')">Copiar Comando</button>
</pre>
<pre><code id="comando27">SecRuleEngine DetectionOnly</code>
<button class="copy-button" onclick="copiarComando('comando25')">Copiar Comando</button>
</pre>
<pre><code id="comando28">On</code>
<button class="copy-button" onclick="copiarComando('comando26')">Copiar Comando</button>
</pre>

<h2>Passo 15: Editar o arquivo de configuração principal do Nginx</h2>
<pre><code id="comando29">nano /etc/nginx/modsec/main.conf</code>
<button class="copy-button" onclick="copiarComando('comando27')">Copiar Comando</button>
</pre>
<pre><code id="comando30">Include /etc/nginx/modsec/modsecurity.conf</code>
<button class="copy-button" onclick="copiarComando('comando28')">Copiar Comando</button>
</pre>

<h2>Passo 16: Adicionar regras de segurança</h2>
<pre><code id="comando31">cp /usr/local/src/ModSecurity/unicode.mapping /etc/nginx/modsec/</code>
<button class="copy-button" onclick="copiarComando('comando29')">Copiar Comando</button>
</pre>

<h2>Passo 17: Verificar a configuração do Nginx</h2>
<pre><code id="comando32">nginx -t</code>
<button class="copy-button" onclick="copiarComando('comando30')">Copiar Comando</button>
</pre>

<h2>Passo 18: Reiniciar o Nginx</h2>
<pre><code id="comando33">systemctl restart nginx</code>
<button class="copy-button" onclick="copiarComando('comando31')">Copiar Comando</button>
</pre>

<h2>Passo 19: Verificar o status do Nginx</h2>
<pre><code id="comando34">systemctl status nginx</code>
<button class="copy-button" onclick="copiarComando('comando32')">Copiar Comando</button>
</pre>

<h2>Passo 20: Baixar o conjunto de regras Core Rule Set (CRS)</h2>
<pre><code id="comando35">wget https://github.com/coreruleset/coreruleset/archive/v3.3.0.tar.gz</code>
<button class="copy-button" onclick="copiarComando('comando33')">Copiar Comando</button>
</pre>

<h2>Passo 21: Extrair o conjunto de regras CRS</h2>
<pre><code id="comando36">tar xvf v3.3.0.tar.gz</code>
<button class="copy-button" onclick="copiarComando('comando34')">Copiar Comando</button>
</pre>

<h2>Passo 22: Mover o conjunto de regras CRS para o diretório ModSecurity</h2>
<pre><code id="comando37">mv coreruleset-3.3.0/ /etc/nginx/modsec/</code>
<button class="copy-button" onclick="copiarComando('comando35')">Copiar Comando</button>
</pre>

<h2>Passo 23: Renomear o arquivo de configuração de exemplo</h2>
<pre><code id="comando38">mv /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf.example /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf</code>
<button class="copy-button" onclick="copiarComando('comando36')">Copiar Comando</button>
</pre>

<h2>Passo 24: Editar o arquivo de configuração principal do ModSecurity</h2>
<pre><code id="comando39">nano /etc/nginx/modsec/main.conf</code>
<button class="copy-button" onclick="copiarComando('comando37')">Copiar Comando</button>
</pre>
<pre><code id="comando40">Include /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf</code>
<button class="copy-button" onclick="copiarComando('comando38')">Copiar Comando</button>
</pre>
<pre><code id="comando41">Include /etc/nginx/modsec/coreruleset-3.3.0/rules/*.conf</code>
<button class="copy-button" onclick="copiarComando('comando39')">Copiar Comando</button>
</pre>

<h2>Passo 24: Reiniciar o Nginx</h2>
<pre><code id="comando42">systemctl restart nginx</code>
<button class="copy-button" onclick="copiarComando('comando40')">Copiar Comando</button>
</pre>


    <script>
        // Função para copiar o conteúdo da caixa de código para a área de transferência
        function copiarComando(id) {
            const elemento = document.getElementById(id);
            const texto = elemento.innerText;

            const textarea = document.createElement('textarea');
            textarea.value = texto;
            document.body.appendChild(textarea);

            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            alert('Comando copiado para a área de transferência: ' + texto);
        }
    </script>
</body>
</html>

