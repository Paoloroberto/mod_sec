<!DOCTYPE html>
<html>

<head>
    <style>
        .copy-button {
            background-color: #FFFF99; /* Amarelo Claro */
            border: none;
            color: black;
            padding: 5px 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 5px 2px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Guia de Instalação</h1>

    <div>
        <h2>Atualizar os pacotes</h2>
        <pre>
            <code id="step1">
apt update
            </code>
            <button class="copy-button" onclick="copyToClipboard('step1')">Copiar</button>
        </pre>
    </div>

    <div>
        <h2>Instalar pacotes necessários</h2>
        <pre>
            <code id="step2">
apt install make gcc build-essential autoconf automake libtool libfuzzy-dev ssdeep gettext pkg-config libcurl4-openssl-dev liblua5.3-dev libpcre3 libpcre3-dev libxml2 libxml2-dev libyajl-dev doxygen libcurl4 libgeoip-dev libssl-dev zlib1g-dev libxslt-dev liblmdb-dev libpcre++-dev libgd-dev
            </code>
            <button class="copy-button" onclick="copyToClipboard('step2')">Copiar</button>
        </pre>
    </div>

    <div>
        <h2>Instalar o Nginx</h2>
        <pre>
            <code id="step3">
apt update
apt install nginx-core nginx-common nginx nginx-full
            </code>
            <button class="copy-button" onclick="copyToClipboard('step3')">Copiar</button>
        </pre>
    </div>

    <div>
        <h2>Configurar o ambiente do ModSecurity</h2>
        <pre>
            <code id="step4">
mkdir -p /usr/local/src/nginx
chown $USER:$USER -R /usr/local/src/
cd /usr/local/src/nginx
apt source nginx
nginx -v
apt install libmodsecurity3
git clone --depth 1 -b v3/master --single-branch https://github.com/SpiderLabs/ModSecurity /usr/local/src/ModSecurity/
cd /usr/local/src/ModSecurity/
git submodule init
git submodule update
./build.sh
./configure
make -j4
make install
git clone --depth 1 https://github.com/SpiderLabs/ModSecurity-nginx.git /usr/local/src/ModSecurity-nginx/
cd /usr/local/src/nginx/nginx-1.tab
apt build-dep nginx
apt install uuid-dev
./configure --with-compat --add-dynamic-module=/usr/local/src/ModSecurity-nginx
make modules
cp objs/ngx_http_modsecurity_module.so /usr/share/nginx/modules/
nano /etc/nginx/nginx.conf
            </code>
            <button class="copy-button" onclick="copyToClipboard('step4')">Copiar</button>
        </pre>
    </div>

    <div>
        <h2>Configurar ModSecurity</h2>
        <pre>
            <code id="step5">
load_module modules/ngx_http_modsecurity_module.so;
modsecurity on;
modsecurity_rules_file /etc/nginx/modsec/main.conf;
mkdir /etc/nginx/modsec/
cp /usr/local/src/ModSecurity/modsecurity.conf-recommended /etc/nginx/modsec/modsecurity.conf
nano /etc/nginx/modsec/modsecurity.conf
SecRuleEngine DetectionOnly
On
nano /etc/nginx/modsec/main.conf
Include /etc/nginx/modsec/modsecurity.conf
cp /usr/local/src/ModSecurity/unicode.mapping /etc/nginx/modsec/
nginx -t
systemctl restart nginx
systemctl status nginx
wget https://github.com/coreruleset/coreruleset/archive/v3.3.0.tar.gz
tar xvf v3.3.0.tar.gz
mv coreruleset-3.3.0/ /etc/nginx/modsec/
mv /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf.example /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf
nano /etc/nginx/modsec/main.conf
Include /etc/nginx/modsec/coreruleset-3.3.0/crs-setup.conf
Include /etc/nginx/modsec/coreruleset-3.3.0/rules/*.conf
systemctl restart nginx
            </code>
            <button class="copy-button" onclick="copyToClipboard('step5')">Copiar</button>
        </pre>
    </div>

    <script>
        function copyToClipboard(elementId) {
            var text = document.getElementById(elementId).textContent;
            var textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Texto copiado para a área de transferência.');
        }
    </script>
</body>

</html>
